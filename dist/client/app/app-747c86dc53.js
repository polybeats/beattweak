"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(){angular.module("beattweakApp",["ngAnimate","ngCookies","ngSanitize","ngMessages","ngAria","ngResource","ui.router","ngMaterial","toastr"])}(),angular.module("beattweakApp.util",[]),function(){function t(t,e,n,r){t.debugEnabled(!0),e.allowHtml=!0,e.timeOut=3e3,e.positionClass="toast-top-right",e.preventDuplicates=!0,e.progressBar=!0,n.theme("default").primaryPalette("blue-grey").dark(),r.html5Mode(!0)}t.$inject=["$logProvider","toastrConfig","$mdThemingProvider","$locationProvider"],angular.module("beattweakApp").config(t)}(),function(t,e){t.module("beattweakApp.constants",[]).constant("appConfig",{userRoles:["guest","user","admin"]})}(angular),function(){angular.module("beattweakApp").constant("moment",moment)}(),function(){function t(t,e){t.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}).state("home.login",{url:"/login",templateUrl:"app/components/login/loginModal.html",controller:"LoginModalCtrl",controllerAs:"login"}).state("secure",{url:"/secure",templateUrl:"app/main/main.html",controller:"SecureController",controllerAs:"main"}),e.otherwise("/")}t.$inject=["$stateProvider","$urlRouterProvider"],angular.module("beattweakApp").config(t)}(),function(){function t(t){t.debug("runBlock end")}t.$inject=["$log"],angular.module("beattweakApp").run(t)}(),function(){function t(){function t(t,e,n,r){var o=t,a=n;o.updateTempo=function(){o.dm.setTempo(o.bpm)},o.togglePlay=function(){a.playing()?(r.debug("stop clock"),a.stop()):(r.debug("start clock"),a.play(),o.rhythmIndex=a.rhythmIndex),o.playing=o.dm.playing()}}t.$inject=["$scope","$rootScope","drumMachine","$log"];var e={restrict:"E",templateUrl:"app/components/drumMachine/drumMachine.html",scope:{dm:"=",bpm:"="},controller:t,controllerAs:"Ctrl"};return e}angular.module("beattweakApp").directive("btDrumMachine",t)}(),function(){function t(t,e){var n=[];this.getChannels=function(){return n};var r=function(r,o,a){var i=n[o],l="/assets/sounds/"+r;t.get(l,{responseType:"arraybuffer"}).success(function(t){e.debug("Read '"+l+"' with "+t.byteLength+" bytes in a variable of type '"+t+"'"),a.decodeAudioData(t,function(t){var e=function(){var e=a.createBufferSource();return e.buffer=t,e.connect(a.destination),e};i.sound={createNode:e}})}).error(function(t,n){e.error("Request failed with status: "+n)})};this.loadInstruments=function(e,o,a){var i,l=a||"/app/components/drumMachine/defaults/local-kit.json";return t.get(l).then(function(t){for(var a=function(){this.sequence.forEach(function(t){t.active=!1})},l=0;4>l;l++){i=t.data.instruments[l];for(var c={channel:l+1,title:i.name,sound:null,sequence:[]},s=function(){this.active=!this.active},u=function(){this.active=!1},p=function(){this.playing=!this.playing},d=function(){this.playing=!1},m=0;e>m;m++)c.sequence.push({active:!1,toggle:s,clear:u,playing:!1,togglePlay:p,stopPlay:d,getClasses:function(){return{active:this.active,playing:this.playing}}});c.clearBeats=a,c.getSequence=function(){return this.sequence},n.push(c),r(i.file,l,o)}return"Instruments Loaded"})}}angular.module("beattweakApp").service("channel",t),t.$inject=["$http","$log"]}(),function(){angular.module("beattweakApp").factory("drumMachine",["$http","$q","channel","$window","$rootScope","$log",function(t,e,n,r,o,a){function i(){return n.loadInstruments(C,y).then(function(){return E=n.getChannels(),a.debug("rows: "+JSON.stringify(E)),"success"})}function l(){var t=w,e=C>t+1?t+1:0;E.forEach(function(n){t>-1&&n.sequence[t].togglePlay(),n.sequence[e].togglePlay()}),w=e,o.$digest()}function c(t){E.forEach(function(e){e.sequence[t].stopPlay()})}function s(){return E=n.getChannels()}function u(){return C}function p(){w=-1,b=new WAAClock(y,{toleranceEarly:.1}),k=!0,a.debug("play started"),b.start(),E.forEach(function(t,e){t.sequence.forEach(function(t,n){t.active&&M(e,n)})}),_=b.callbackAtTime(l,L(0)).repeat(.25*T).tolerance({early:.1,late:1})}function d(){k=!1,_.clear(),c(w),b.stop()}function m(){return A}function f(t){A=t,T=60/A,$=x*T}function h(){return k}function g(){a.debug("reset started"),E.forEach(function(t){t.clearBeats()})}function v(){return y}r.AudioContext||alert("you browser doesnt support Web Audio API");var b,y,w,k,_,A=120,x=4,C=16,T=60/A,$=x*T,E=[],M=function(t,e){if(k){var n=E[t].sequence[e],r=b.callbackAtTime(function(e){var n=E[t].sound.createNode();n.start(e.deadline)},L(e));r.repeat($),r.tolerance({late:.01}),n.event=r}},S=function(t,e){if(k){var n=E[t].sequence[e].event;n.clear()}},L=function(t){var e=.25,n=y.currentTime,r=Math.floor(n/$),o=Math.round(n%$);return t>o?r*$+t*T*e:(r+1)*$+t*T*e};return y=new AudioContext,{loadInstruments:i,gridLength:u,channels:s,tempo:m,setTempo:f,play:p,playing:h,stop:d,reset:g,startBeat:M,stopBeat:S,context:v,rhythmIndex:w}}])}(),angular.module("beattweakApp").factory("eventQueue",function(){function t(){return r}function e(){r=[]}function n(t){r.push(t)}var r=new Array;return{queue:t,add:n,clear:e}}),function(){function t(){function t(t){var e=t;e.toggleActive=function(t){var n=e.channel.getSequence();t<n.length&&(n[t].active?e.stopBeat(e.channelIndex,t):e.startBeat(e.channelIndex,t),n[t].toggle())}}t.$inject=["$scope"];var e={restrict:"E",templateUrl:"app/components/drumMachine/row/row.html",scope:{channel:"=",numCols:"=",startBeat:"=",stopBeat:"=",channelIndex:"="},controller:t,controllerAs:"vm"};return e}angular.module("beattweakApp").directive("btRow",t)}(),function(){angular.module("beattweakApp").factory("freesound",["$http",function(t){function e(t){}function n(t){}function r(){}return{download:e,search:n,login:r}}])}(),function(){function t(t,e){function n(n){function o(t){return t.data}function a(e){t.error("XHR Failed for getContributors.\n"+angular.toJson(e.data,!0))}return n||(n=30),e.get(r+"/contributors?per_page="+n).then(o)["catch"](a)}var r="https://api.github.com/repos/Swiip/generator-gulp-angular",o={apiHost:r,getContributors:n};return o}t.$inject=["$log","$http"],angular.module("beattweakApp").factory("githubContributor",t)}(),function(){function t(t){function e(e,n,r,o){var a,i=t(n[0],{typeSpeed:40,deleteSpeed:40,pauseDelay:800,loop:!0,postfix:" "});n.addClass("acme-malarkey"),angular.forEach(e.extraValues,function(t){i.type(t).pause()["delete"]()}),a=e.$watch("vm.contributors",function(){angular.forEach(o.contributors,function(t){i.type(t.login).pause()["delete"]()})}),e.$on("$destroy",function(){a()})}function n(t,e){function n(){return r().then(function(){t.info("Activated Contributors View")})}function r(){return e.getContributors(10).then(function(t){return o.contributors=t,o.contributors})}var o=this;o.contributors=[],n()}n.$inject=["$log","githubContributor"];var r={restrict:"E",scope:{extraValues:"="},template:"&nbsp;",link:e,controller:n,controllerAs:"vm"};return r}t.$inject=["malarkey"],angular.module("beattweakApp").directive("acmeMalarkey",t)}(),function(){function t(){function t(t){var e=this;e.freesound_auth="https://www.freesound.org/apiv2/oauth2/authorize/?client_id=70d56c921dd7f8ed69a7&response_type=code",e.relativeDate=t(e.creationDate).fromNow()}t.$inject=["moment"];var e={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:t,controllerAs:"vm",bindToController:!0};return e}angular.module("beattweakApp").directive("btNavbar",t)}(),function(){angular.module("beattweakApp").factory("socket",["$rootScope",function(t){var e=null;return{on:function(n,r){e.on(n,function(){var n=arguments;t.$apply(function(){r.apply(e,n)})})},emit:function(n,r,o){e.emit(n,r,function(){var n=arguments;t.$apply(function(){o&&o.apply(e,n)})})}}}])}(),function(){function t(){function t(){return e}var e=[{title:"AngularJS",url:"https://angularjs.org/",description:"HTML enhanced for web apps!",logo:"angular.png"},{title:"BrowserSync",url:"http://browsersync.io/",description:"Time-saving synchronised browser testing.",logo:"browsersync.png"},{title:"GulpJS",url:"http://gulpjs.com/",description:"The streaming build system.",logo:"gulp.png"},{title:"Jasmine",url:"http://jasmine.github.io/",description:"Behavior-Driven JavaScript.",logo:"jasmine.png"},{title:"Karma",url:"http://karma-runner.github.io/",description:"Spectacular Test Runner for JavaScript.",logo:"karma.png"},{title:"Protractor",url:"https://github.com/angular/protractor",description:"End to end test framework for AngularJS applications built on top of WebDriverJS.",logo:"protractor.png"},{title:"Angular Material Design",url:"https://material.angularjs.org/#/",description:"The Angular reference implementation of the Google's Material Design specification.",logo:"angular-material.png"},{title:"Sass (Node)",url:"https://github.com/sass/node-sass",description:"Node.js binding to libsass, the C version of the popular stylesheet preprocessor, Sass.",logo:"node-sass.png"}];this.getTec=t}angular.module("beattweakApp").service("webDevTec",t)}(),function(){function t(t,e,n){var r=this,o=e,a=n;o.loading=!0,r.creationDate=new Date,n.loadInstruments().then(function(){o.loading=!1,o.dm=a,o.bpm=a.tempo()})}function e(t,e,n){var r=this,o=e,a=n;o.loading=!0,r.creationDate=new Date,n.loadInstruments().then(function(){o.loading=!1,o.dm=a,o.bpm=a.tempo()})}angular.module("beattweakApp").controller("MainController",t),t.$inject=["$scope","$rootScope","drumMachine"],e.$inject=t.$inject}(),function(t,e,n){function r(n,a){if(!e[n]){if(!t[n]){var i="function"==typeof require&&require;if(!a&&i)return i(n,!0);if(o)return o(n,!0);throw new Error("Cannot find module '"+n+"'")}var l=e[n]={exports:{}};t[n][0].call(l.exports,function(e){var o=t[n][1][e];return r(o?o:e)},l,l.exports)}return e[n].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,e,n){var r=t("./lib/WAAClock");e.exports=r,"undefined"!=typeof window&&(window.WAAClock=r)},{"./lib/WAAClock":2}],3:[function(t,e,n){var r=e.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")}},{}],2:[function(t,e,n){var r=t("__browserify_process"),o="undefined"!=typeof window;if(o&&!AudioContext)throw new Error("This browser doesn't seem to support web audio API");var a={toleranceLate:.1,toleranceEarly:.001},i=function(t,e,n){this.clock=t,this.func=n,this.repeatTime=null,this.toleranceLate=a.toleranceLate,this.toleranceEarly=a.toleranceEarly,this._armed=!1,this._latestTime=null,this._earliestTime=null,this.schedule(e)};i.prototype.clear=function(){return this.clock._removeEvent(this),this},i.prototype.repeat=function(t){if(0===t)throw new Error("delay cannot be 0");return this.repeatTime=t,this},i.prototype.tolerance=function(t){return"number"==typeof t.late&&(this.toleranceLate=t.late),"number"==typeof t.early&&(this.toleranceEarly=t.early),this._update(),this},i.prototype.isRepeated=function(){return null!==this.repeatTime},i.prototype.schedule=function(t){this._armed=!0,this.deadline=t,this._update(),this.clock.context.currentTime>=this._earliestTime&&(this.clock._removeEvent(this),this._execute())},i.prototype._execute=function(){this._armed=!1,this.clock.context.currentTime<this._latestTime?this.func(this):(this.onexpired&&this.onexpired(this),console.warn("event expired")),this._armed===!1&&this.isRepeated()&&this.schedule(this.deadline+this.repeatTime)},i.prototype._update=function(){this._latestTime=this.deadline+this.toleranceLate,this._earliestTime=this.deadline-this.toleranceEarly,this.clock._removeEvent(this),this.clock._insertEvent(this)};var l=e.exports=function(t,e){e=e||{},this.toleranceEarly=e.toleranceEarly||a.toleranceEarly,this.toleranceLate=e.toleranceLate||a.toleranceLate,this.context=t,this._events=[],this._started=!1};l.prototype.setTimeout=function(t,e){return this._createEvent(t,this._absTime(e))},l.prototype.callbackAtTime=function(t,e){return this._createEvent(t,e)},l.prototype.timeStretch=function(t,e,n){var r=this,o=r.context.currentTime;return e.forEach(function(e){e.isRepeated()&&e.repeat(e.repeatTime*n);var r=t+n*(e.deadline-t);if(e.isRepeated())for(;o>=r-e.toleranceEarly;)r+=e.repeatTime;e.schedule(r)}),e},l.prototype.start=function(){if(this._started===!1){var t=this;this._started=!0,this._events=[];var e=256;this._clockNode=this.context.createScriptProcessor(e,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){r.nextTick(function(){t._tick()})}}},l.prototype.stop=function(){this._started===!0&&(this._started=!1,this._clockNode.disconnect())},l.prototype._tick=function(){for(var t=this._events.shift();t&&t._earliestTime<=this.context.currentTime;)t._execute(),t=this._events.shift();t&&this._events.unshift(t)},l.prototype._createEvent=function(t,e){var n=new i(this,e,t);return n.tolerance({late:this.toleranceLate,early:this.toleranceEarly}),n},l.prototype._insertEvent=function(t){this._events.splice(this._indexByTime(t._earliestTime),0,t)},l.prototype._removeEvent=function(t){var e=this._events.indexOf(t);-1!==e&&this._events.splice(e,1)},l.prototype._indexByTime=function(t){for(var e,n=0,r=this._events.length;r>n;)e=Math.floor((n+r)/2),this._events[e]._earliestTime<t?n=e+1:r=e;return n},l.prototype._absTime=function(t){return t+this.context.currentTime},l.prototype._relTime=function(t){return t-this.context.currentTime}},{__browserify_process:3}]},{},[1]),angular.module("beattweakApp").directive("footer",function(){return{templateUrl:"components/footer/footer.html",restrict:"E",link:function(t,e){e.addClass("footer")}}});var NavbarController=function t(){_classCallCheck(this,t),this.menu=[{title:"Home",state:"main"}],this.isCollapsed=!0};angular.module("beattweakApp").controller("NavbarController",NavbarController),angular.module("beattweakApp").directive("navbar",function(){return{templateUrl:"components/navbar/navbar.html",restrict:"E",controller:"NavbarController",controllerAs:"nav"}}),angular.module("beattweakApp").factory("socket",["socketFactory",function(t){var e=io("",{path:"/socket.io-client"}),n=t({ioSocket:e});return{socket:n,syncUpdates:function(t,e,r){r=r||angular.noop,n.on(t+":save",function(t){var n=_.find(e,{_id:t._id}),o=e.indexOf(n),a="created";n?(e.splice(o,1,t),a="updated"):e.push(t),r(a,t,e)}),n.on(t+":remove",function(t){var n="deleted";_.remove(e,{_id:t._id}),r(n,t,e)})},unsyncUpdates:function(t){n.removeAllListeners(t+":save"),n.removeAllListeners(t+":remove")}}}]),function(){function t(t){var e={safeCb:function(t){return angular.isFunction(t)?t:angular.noop},urlParse:function(t){var e=document.createElement("a");return e.href=t,""===e.host&&(e.href=e.href),e},isSameOrigin:function(n,r){return n=e.urlParse(n),r=r&&[].concat(r)||[],r=r.map(e.urlParse),r.push(t.location),r=r.filter(function(t){return n.hostname===t.hostname&&n.port===t.port&&n.protocol===t.protocol}),r.length>=1}};return e}t.$inject=["$window"],angular.module("beattweakApp.util").factory("Util",t)}(),angular.module("beattweakApp").run(["$templateCache",function(t){t.put("app/main/main.html",'<bt-navbar creation-date="main.creationDate"></bt-navbar>\r\n\r\n<div class="bt-main-content" layout="column" layout-align="start center" layout-padding layout-fill>\r\n  <div flex></div>\r\n  <bt-drum-machine class="bt-drum-machine" bpm=\'bpm\' dm=\'dm\'>\r\n  </bt-drum-machine>\r\n\r\n</div>\r\n'),t.put("components/footer/footer.html",'<div class="container">\r\n  <p>Angular Fullstack v3.6.1 |\r\n    <a href="https://twitter.com/tyhenkel">@tyhenkel</a> |\r\n    <a href="https://github.com/DaftMonk/generator-angular-fullstack/issues?state=open">Issues</a>\r\n  </p>\r\n</div>\r\n'),t.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller="NavbarController">\r\n  <div class="container">\r\n    <div class="navbar-header">\r\n      <button class="navbar-toggle" type="button" ng-click="nav.isCollapsed = !nav.isCollapsed">\r\n        <span class="sr-only">Toggle navigation</span>\r\n        <span class="icon-bar"></span>\r\n        <span class="icon-bar"></span>\r\n        <span class="icon-bar"></span>\r\n      </button>\r\n      <a href="/" class="navbar-brand">beattweak</a>\r\n    </div>\r\n    <div uib-collapse="nav.isCollapsed" class="navbar-collapse collapse" id="navbar-main">\r\n      <ul class="nav navbar-nav">\r\n        <li ng-repeat="item in nav.menu" ui-sref-active="active">\r\n            <a ui-sref="{{item.state}}">{{item.title}}</a>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</div>\r\n'),t.put("app/components/drumMachine/drumMachine.html",'<bt-row ng-repeat="channel in dm.channels()" channel="channel" channel-index="$index" start-beat="dm.startBeat" stop-beat="dm.stopBeat" num-cols="dm.gridLength()"  class="channel" flex="10">\r\n</bt-row>\r\n<div class="control-row" layout="row" layout-align="start center">\r\n  <div flex-offset="5" flex="10">\r\n    <md-button ng-click="togglePlay()" aria-label="Toggle Play">\r\n      <md-icon class="material-icons md-light md-48" ng-hide="dm.playing()">play_circle_outline</md-icon>\r\n      <md-icon class="material-icons md-light md-48" ng-show="dm.playing()">pause_circle_outline</md-icon>\r\n    </md-button>\r\n  </div>\r\n  <div flex="10">\r\n    <md-button ng-disabled="dm.playing()" ng-click="dm.reset()" aria-label="clear">\r\n      Clear\r\n    </md-button>\r\n  </div>\r\n  <div flex="25" ng-cloak>\r\n    <h4 class="bpm-text">{{bpm}} bpm</h4>\r\n    <md-slider ng-change="updateTempo()" ng-model="bpm" min="40" max="200" aria-label="bpm adjustment" ng-disabled="playing"></md-slider>\r\n  </div>\r\n</div>'),t.put("app/components/login/loginModal.html",'<md-dialog aria-label="List dialog">\r\n  <md-dialog-content>\r\n  <form ng-submit="LoginModalCtrl.submit(_email, _password)">\r\n    <input type="email" ng-model="_email" />\r\n    <input type="password" ng-model="_password" />\r\n    <button>Submit</button>\r\n  </form>\r\n  <!-- <button ng-click="LoginModalCtrl.cancel()">Cancel</button> -->\r\n  </md-dialog-content>\r\n  <md-dialog-actions>\r\n    <md-button ng-click="LoginModalCtrl.cancel()" class="md-primary">Cancel</md-button>\r\n  </md-dialog-actions>\r\n</md-dialog>'),t.put("app/components/navbar/navbar.html",'<md-toolbar>\r\n  <div class="bt-navbar" layout="row" layout-align="end center" flex>\r\n    <div flex="10"><h2>Beat Tweak</h2></div>\r\n\r\n    <section flex="45" layout="row" layout-align="end center">\r\n      <!-- <md-button href="#" class="md-icon-button" aria-label="settings">\r\n        <md-icon class="md-light">settings</md-icon>\r\n      </md-button> -->\r\n      <md-button href="{{vm.freesound_auth}}" class="md-icon-button" aria-label="settings">\r\n        <md-icon class="md-light">account_circle</md-icon>\r\n      </md-button>\r\n    </section>\r\n\r\n    <!-- <md-button class="acme-navbar-text">Application was created {{ vm.relativeDate }}.</md-button> -->\r\n  </div>\r\n</md-toolbar>\r\n'),t.put("app/components/drumMachine/row/row.html",'<div flex="10">\r\n  <h5 class="channel-title">{{channel.title}}</h5>\r\n</div>\r\n<md-grid-list class="sequence"\r\n  md-cols="{{numCols}}"\r\n  md-row-height="1:1" \r\n  md-gutter="1em"\r\nflex>\r\n  <!-- TODO: represent beat state -->\r\n  <md-grid-tile ng-repeat="beat in channel.sequence" ng-click="toggleActive($index)" ng-class="beat.getClasses()">\r\n  <!-- <md-grid-tile-footer>\r\n    <h4>{{beat.active}}</h4>\r\n  </md-grid-tile-footer> -->\r\n  </md-grid-tile>\r\n</md-grid-list>')}]);